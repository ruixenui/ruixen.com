{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "hover-play-card",
  "type": "registry:ui",
  "title": "Hover Play Card",
  "description": "Video card that breathes — hover to preview muted, click to play with sound. Spring-animated play icon, glass overlay, and progress line.",
  "dependencies": [
    "motion"
  ],
  "files": [
    {
      "path": "registry/ruixenui/hover-play-card.tsx",
      "content": "\"use client\";\n\nimport { useRef, useState, useEffect } from \"react\";\nimport { motion, AnimatePresence } from \"motion/react\";\n\n/**\n * Hover Play Card — video that breathes.\n *\n * Hover: video plays muted, progress line emerges at bottom.\n * Click: unmute and play with sound. Click again to pause.\n * The center icon springs in and out. The card responds.\n *\n * No shadcn. No lucide. Just the content and the breath.\n */\n\n/* ── Types ── */\n\nexport interface HoverPlayCardProps {\n  src: string;\n  poster?: string;\n  loop?: boolean;\n  mutedOnHover?: boolean;\n  sound?: boolean;\n}\n\n/* ── Audio ── */\n\nlet _ctx: AudioContext | null = null;\nlet _buf: AudioBuffer | null = null;\n\nfunction audioCtx() {\n  if (!_ctx) {\n    _ctx = new (window.AudioContext ||\n      (window as unknown as { webkitAudioContext: typeof AudioContext })\n        .webkitAudioContext)();\n  }\n  if (_ctx.state === \"suspended\") _ctx.resume();\n  return _ctx;\n}\n\nfunction ensureBuf(ac: AudioContext): AudioBuffer {\n  if (_buf && _buf.sampleRate === ac.sampleRate) return _buf;\n  const rate = ac.sampleRate;\n  const len = Math.floor(rate * 0.003);\n  const buf = ac.createBuffer(1, len, rate);\n  const ch = buf.getChannelData(0);\n  for (let i = 0; i < len; i++) {\n    const t = i / len;\n    ch[i] = (Math.random() * 2 - 1) * (1 - t) ** 4;\n  }\n  _buf = buf;\n  return buf;\n}\n\nfunction tick(last: React.MutableRefObject<number>) {\n  const now = performance.now();\n  if (now - last.current < 50) return;\n  last.current = now;\n  try {\n    const ac = audioCtx();\n    const buf = ensureBuf(ac);\n    const src = ac.createBufferSource();\n    const gain = ac.createGain();\n    src.buffer = buf;\n    gain.gain.value = 0.04;\n    src.connect(gain);\n    gain.connect(ac.destination);\n    src.start();\n  } catch {\n    /* silent */\n  }\n}\n\n/* ── Inline SVG Icons ── */\n\nfunction IcoPlay({ size = 28 }: { size?: number }) {\n  return (\n    <svg width={size} height={size} viewBox=\"0 0 28 28\" fill=\"currentColor\">\n      <path d=\"M8 4v20l16-10L8 4z\" />\n    </svg>\n  );\n}\n\nfunction IcoPause({ size = 28 }: { size?: number }) {\n  return (\n    <svg width={size} height={size} viewBox=\"0 0 28 28\" fill=\"currentColor\">\n      <rect x=\"6\" y=\"4\" width=\"5\" height=\"20\" rx=\"1\" />\n      <rect x=\"17\" y=\"4\" width=\"5\" height=\"20\" rx=\"1\" />\n    </svg>\n  );\n}\n\n/* ── Component ── */\n\nexport function HoverPlayCard({\n  src,\n  poster,\n  loop = false,\n  mutedOnHover = true,\n  sound = true,\n}: HoverPlayCardProps) {\n  const videoRef = useRef<HTMLVideoElement>(null);\n  const lastSnd = useRef(0);\n\n  const [hovering, setHovering] = useState(false);\n  const [playing, setPlaying] = useState(false);\n  const [userStarted, setUserStarted] = useState(false);\n  const [prevMuted, setPrevMuted] = useState<boolean | null>(null);\n  const [progress, setProgress] = useState(0);\n\n  /* ── Hover autoplay ── */\n  useEffect(() => {\n    const v = videoRef.current;\n    if (!v) return;\n    let ignore = false;\n\n    if (hovering && !userStarted) {\n      if (prevMuted === null) setPrevMuted(v.muted);\n      if (mutedOnHover) v.muted = true;\n      v.play()\n        .then(() => {\n          if (!ignore) setPlaying(true);\n        })\n        .catch(() => {\n          if (!ignore) setPlaying(false);\n        });\n    } else if (!hovering && !userStarted) {\n      v.pause();\n      setPlaying(false);\n      if (prevMuted !== null) v.muted = prevMuted;\n    }\n\n    return () => {\n      ignore = true;\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [hovering, mutedOnHover, userStarted]);\n\n  /* ── Sync native events ── */\n  useEffect(() => {\n    const v = videoRef.current;\n    if (!v) return;\n    const onPlay = () => setPlaying(true);\n    const onPause = () => setPlaying(false);\n    const onEnded = () => {\n      setPlaying(false);\n      setUserStarted(false);\n    };\n    const onTime = () => {\n      if (v.duration > 0)\n        setProgress((v.currentTime / v.duration) * 100);\n    };\n\n    v.addEventListener(\"play\", onPlay);\n    v.addEventListener(\"pause\", onPause);\n    v.addEventListener(\"ended\", onEnded);\n    v.addEventListener(\"timeupdate\", onTime);\n\n    return () => {\n      v.removeEventListener(\"play\", onPlay);\n      v.removeEventListener(\"pause\", onPause);\n      v.removeEventListener(\"ended\", onEnded);\n      v.removeEventListener(\"timeupdate\", onTime);\n    };\n  }, []);\n\n  /* ── Click handler ── */\n  const handleClick = async () => {\n    const v = videoRef.current;\n    if (!v) return;\n\n    if (!playing) {\n      setUserStarted(true);\n      v.muted = false;\n      setPrevMuted(false);\n      try {\n        await v.play();\n        setPlaying(true);\n      } catch {\n        setPlaying(false);\n      }\n    } else {\n      v.pause();\n      setPlaying(false);\n    }\n    if (sound) tick(lastSnd);\n  };\n\n  return (\n    <>\n      <style>{`\n        .hpc{--h-border:rgba(0,0,0,0.06)}\n        .dark .hpc,[data-theme=\"dark\"] .hpc{--h-border:rgba(255,255,255,0.06)}\n      `}</style>\n      <div\n        className=\"hpc\"\n        onMouseEnter={() => setHovering(true)}\n        onMouseLeave={() => setHovering(false)}\n        style={{\n          position: \"relative\",\n          borderRadius: 14,\n          overflow: \"hidden\",\n          border: \"1px solid var(--h-border)\",\n          cursor: \"pointer\",\n          width: \"100%\",\n          maxWidth: 560,\n          aspectRatio: \"16/9\",\n          background: \"#000\",\n        }}\n      >\n        {/* Video — absolute-fill so container holds shape via aspectRatio */}\n        <video\n          ref={videoRef}\n          src={src}\n          poster={poster}\n          loop={loop}\n          playsInline\n          crossOrigin=\"anonymous\"\n          style={{\n            position: \"absolute\",\n            inset: 0,\n            width: \"100%\",\n            height: \"100%\",\n            objectFit: \"cover\",\n            display: \"block\",\n          }}\n        />\n\n        {/* Center play/pause — overlay */}\n        <AnimatePresence>\n          {(hovering || !playing) && (\n            <motion.div\n              key=\"overlay\"\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n              transition={{ duration: 0.15 }}\n              onClick={(e) => {\n                e.stopPropagation();\n                handleClick();\n              }}\n              style={{\n                position: \"absolute\",\n                inset: 0,\n                display: \"flex\",\n                alignItems: \"center\",\n                justifyContent: \"center\",\n                zIndex: 2,\n              }}\n            >\n              {/* Glass circle — spring squish on click */}\n              <motion.div\n                whileTap={{ scale: 0.85 }}\n                transition={{ type: \"spring\", stiffness: 500, damping: 25 }}\n                style={{\n                  width: 60,\n                  height: 60,\n                  borderRadius: \"50%\",\n                  background: \"rgba(0,0,0,0.3)\",\n                  backdropFilter: \"blur(16px)\",\n                  WebkitBackdropFilter: \"blur(16px)\",\n                  border: \"1px solid rgba(255,255,255,0.08)\",\n                  display: \"flex\",\n                  alignItems: \"center\",\n                  justifyContent: \"center\",\n                  color: \"rgba(255,255,255,0.9)\",\n                  transition: \"background 0.15s\",\n                }}\n                onMouseEnter={(e) => {\n                  e.currentTarget.style.background = \"rgba(0,0,0,0.5)\";\n                }}\n                onMouseLeave={(e) => {\n                  e.currentTarget.style.background = \"rgba(0,0,0,0.3)\";\n                }}\n              >\n                {/* Icon crossfade — keyed for spring swap */}\n                <AnimatePresence mode=\"wait\" initial={false}>\n                  <motion.div\n                    key={playing ? \"pause\" : \"play\"}\n                    initial={{ opacity: 0, scale: 0.6 }}\n                    animate={{ opacity: 1, scale: 1 }}\n                    exit={{ opacity: 0, scale: 0.6 }}\n                    transition={{\n                      type: \"spring\",\n                      stiffness: 500,\n                      damping: 28,\n                    }}\n                    style={{\n                      display: \"flex\",\n                      alignItems: \"center\",\n                      justifyContent: \"center\",\n                    }}\n                  >\n                    {playing ? <IcoPause /> : <IcoPlay />}\n                  </motion.div>\n                </AnimatePresence>\n              </motion.div>\n            </motion.div>\n          )}\n        </AnimatePresence>\n\n        {/* Progress line at bottom */}\n        <motion.div\n          animate={{ opacity: hovering || playing ? 1 : 0 }}\n          transition={{ duration: 0.2 }}\n          style={{\n            position: \"absolute\",\n            bottom: 0,\n            left: 0,\n            right: 0,\n            height: 3,\n            background: \"rgba(255,255,255,0.15)\",\n            zIndex: 3,\n          }}\n        >\n          <motion.div\n            animate={{ width: `${progress}%` }}\n            transition={{ duration: 0.3, ease: \"linear\" }}\n            style={{\n              height: \"100%\",\n              background: \"rgba(255,255,255,0.65)\",\n              borderRadius: \"0 1px 1px 0\",\n            }}\n          />\n        </motion.div>\n      </div>\n    </>\n  );\n}\n\nexport default HoverPlayCard;\n",
      "type": "registry:ui",
      "target": "components/ruixen/hover-play-card.tsx"
    }
  ]
}