{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "audio-timeline-with-chapters",
  "type": "registry:ui",
  "title": "Audio Timeline With Chapters",
  "description": "Interactive audio player with timeline and chapter navigation.",
  "dependencies": [],
  "registryDependencies": [
    "button"
  ],
  "files": [
    {
      "path": "registry/ruixenui/audio-timeline-with-chapters.tsx",
      "content": "\"use client\";\n\nimport * as React from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { cn } from \"@/lib/utils\";\n\nexport interface Chapter {\n  time: number; // seconds\n  label: string;\n}\n\ninterface AudioTimelineWithChaptersProps {\n  audioSrc: string;\n  chapters: Chapter[];\n  width?: number;\n  className?: string;\n}\n\nexport default function AudioTimelineWithChapters({\n  audioSrc,\n  chapters,\n  width = 400,\n  className,\n}: AudioTimelineWithChaptersProps) {\n  const audioRef = React.useRef<HTMLAudioElement | null>(null);\n\n  const [progress, setProgress] = React.useState(0); // 0..100\n  const [isPlaying, setIsPlaying] = React.useState(false);\n  const [duration, setDuration] = React.useState(0);\n  const [errorMsg, setErrorMsg] = React.useState<string | null>(null);\n  const [isReady, setIsReady] = React.useState(false);\n\n  // Attach listeners once\n  React.useEffect(() => {\n    const audio = audioRef.current;\n    if (!audio) return;\n\n    const onLoadedMetadata = () => {\n      setDuration(Number.isFinite(audio.duration) ? audio.duration : 0);\n      setIsReady(true);\n      setErrorMsg(null);\n    };\n\n    const onTimeUpdate = () => {\n      if (!audio.duration || !Number.isFinite(audio.duration)) return;\n      setProgress((audio.currentTime / audio.duration) * 100);\n    };\n\n    const onEnded = () => {\n      setIsPlaying(false);\n    };\n\n    const onError = () => {\n      // Try to provide a helpful message\n      const mediaErr = audio.error;\n      let msg = \"Audio could not be played.\";\n\n      if (mediaErr) {\n        // https://developer.mozilla.org/en-US/docs/Web/API/MediaError/code\n        switch (mediaErr.code) {\n          case mediaErr.MEDIA_ERR_ABORTED:\n            msg = \"Playback was aborted.\";\n            break;\n          case mediaErr.MEDIA_ERR_NETWORK:\n            msg = \"Network error while loading audio (check URL/CORS/403).\";\n            break;\n          case mediaErr.MEDIA_ERR_DECODE:\n            msg = \"Audio decode failed (unsupported/invalid file).\";\n            break;\n          case mediaErr.MEDIA_ERR_SRC_NOT_SUPPORTED:\n            msg = \"Audio source not supported (wrong URL or MIME type).\";\n            break;\n          default:\n            msg = \"Audio error.\";\n        }\n      }\n\n      setErrorMsg(msg);\n      setIsReady(false);\n      setIsPlaying(false);\n    };\n\n    audio.addEventListener(\"loadedmetadata\", onLoadedMetadata);\n    audio.addEventListener(\"timeupdate\", onTimeUpdate);\n    audio.addEventListener(\"ended\", onEnded);\n    audio.addEventListener(\"error\", onError);\n\n    return () => {\n      audio.removeEventListener(\"loadedmetadata\", onLoadedMetadata);\n      audio.removeEventListener(\"timeupdate\", onTimeUpdate);\n      audio.removeEventListener(\"ended\", onEnded);\n      audio.removeEventListener(\"error\", onError);\n    };\n  }, []);\n\n  // When src changes: reset UI state\n  React.useEffect(() => {\n    const audio = audioRef.current;\n    if (!audio) return;\n\n    setProgress(0);\n    setDuration(0);\n    setIsReady(false);\n    setIsPlaying(false);\n    setErrorMsg(null);\n\n    // Force reload of media\n    audio.pause();\n    audio.currentTime = 0;\n    audio.load();\n  }, [audioSrc]);\n\n  const togglePlay = async () => {\n    const audio = audioRef.current;\n    if (!audio) return;\n\n    setErrorMsg(null);\n\n    if (audio.paused) {\n      try {\n        // Ensure we have metadata; if not, browser will still try.\n        await audio.play();\n        setIsPlaying(true);\n      } catch (err) {\n        // This is where your error was coming from\n        setIsPlaying(false);\n        setErrorMsg(\n          \"Unable to start playback. Check that the URL serves an actual audio file (and allows CORS/range requests).\",\n        );\n      }\n    } else {\n      audio.pause();\n      setIsPlaying(false);\n    }\n  };\n\n  const jumpToChapter = async (time: number) => {\n    const audio = audioRef.current;\n    if (!audio) return;\n\n    setErrorMsg(null);\n\n    // clamp time\n    const t = Math.max(0, Math.min(time, duration || time));\n    audio.currentTime = t;\n\n    try {\n      await audio.play();\n      setIsPlaying(true);\n    } catch {\n      setIsPlaying(false);\n      setErrorMsg(\n        \"Unable to play after seeking. Check that the audio source supports seeking (range requests) and is playable.\",\n      );\n    }\n  };\n\n  const onTimelineClick = async (e: React.MouseEvent<HTMLDivElement>) => {\n    const audio = audioRef.current;\n    if (!audio || !duration) return;\n\n    const rect = e.currentTarget.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const ratio = Math.max(0, Math.min(1, x / rect.width));\n    const t = ratio * duration;\n\n    audio.currentTime = t;\n    setErrorMsg(null);\n\n    // Optional: if it was playing, keep playing; if paused, donâ€™t force autoplay\n    if (isPlaying) {\n      try {\n        await audio.play();\n      } catch {\n        setIsPlaying(false);\n        setErrorMsg(\"Could not continue playback after scrubbing.\");\n      }\n    }\n  };\n\n  return (\n    <div className={cn(\"flex flex-col items-center gap-2\", className)}>\n      {/* Real audio element in DOM (more reliable than new Audio()) */}\n      <audio\n        ref={audioRef}\n        src={audioSrc}\n        preload=\"metadata\"\n        crossOrigin=\"anonymous\"\n      />\n\n      {/* Timeline */}\n      <div\n        className=\"relative h-3 cursor-pointer bg-muted/40 border border-border/60\"\n        style={{ width }}\n        onClick={onTimelineClick}\n        role=\"slider\"\n        aria-label=\"Audio timeline\"\n      >\n        <div\n          className=\"absolute left-0 top-0 h-full bg-foreground/70\"\n          style={{ width: `${progress}%` }}\n        />\n\n        {/* Chapter markers */}\n        {duration > 0 &&\n          chapters.map((ch, idx) => (\n            <button\n              key={idx}\n              type=\"button\"\n              className=\"absolute top-0 h-3 w-[3px] bg-foreground/30 hover:bg-foreground/60\"\n              style={{ left: `${(ch.time / duration) * 100}%` }}\n              title={ch.label}\n              onClick={(ev) => {\n                ev.stopPropagation();\n                jumpToChapter(ch.time);\n              }}\n              aria-label={`Jump to ${ch.label}`}\n            />\n          ))}\n      </div>\n\n      {/* Play/Pause */}\n      <Button\n        className=\"w-20 text-sm px-2 py-1\"\n        variant=\"outline\"\n        onClick={togglePlay}\n        disabled={!audioSrc}\n      >\n        {isPlaying ? \"Pause\" : \"Play\"}\n      </Button>\n\n      {/* Error */}\n      {errorMsg ? (\n        <p className=\"text-xs text-destructive text-center max-w-[420px]\">\n          {errorMsg}\n        </p>\n      ) : null}\n\n      {/* Chapters List */}\n      <div className=\"flex flex-wrap justify-center gap-2 mt-2\">\n        {chapters.map((ch, idx) => (\n          <Button\n            key={idx}\n            size=\"sm\"\n            variant=\"outline\"\n            onClick={() => jumpToChapter(ch.time)}\n            disabled={!isReady && duration === 0}\n          >\n            {ch.label}\n          </Button>\n        ))}\n      </div>\n    </div>\n  );\n}\n",
      "type": "registry:ui",
      "target": "components/ruixen/audio-timeline-with-chapters.tsx"
    }
  ]
}