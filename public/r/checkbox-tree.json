{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "checkbox-tree",
  "type": "registry:ui",
  "title": "Checkbox Tree",
  "description": "A hierarchical tree checkbox for nested selections with expand/collapse.",
  "dependencies": [
    "lucide-react"
  ],
  "files": [
    {
      "path": "registry/ruixenui/checkbox-tree.tsx",
      "content": "\"use client\";\n\nimport * as React from \"react\";\nimport { cn } from \"@/lib/utils\";\nimport { Check, Minus, ChevronRight } from \"lucide-react\";\n\ninterface TreeNode {\n  id: string;\n  label: string;\n  children?: TreeNode[];\n}\n\ninterface CheckboxTreeProps {\n  nodes: TreeNode[];\n  value?: string[];\n  defaultValue?: string[];\n  onValueChange?: (value: string[]) => void;\n  className?: string;\n}\n\nfunction getAllChildIds(node: TreeNode): string[] {\n  const ids = [node.id];\n  if (node.children) {\n    node.children.forEach((child) => {\n      ids.push(...getAllChildIds(child));\n    });\n  }\n  return ids;\n}\n\nfunction getNodeState(\n  node: TreeNode,\n  selectedIds: string[],\n): \"checked\" | \"indeterminate\" | \"unchecked\" {\n  if (!node.children || node.children.length === 0) {\n    return selectedIds.includes(node.id) ? \"checked\" : \"unchecked\";\n  }\n\n  const childIds = node.children.flatMap((child) => getAllChildIds(child));\n  const selectedChildCount = childIds.filter((id) =>\n    selectedIds.includes(id),\n  ).length;\n\n  if (selectedChildCount === 0) return \"unchecked\";\n  if (selectedChildCount === childIds.length) return \"checked\";\n  return \"indeterminate\";\n}\n\ninterface TreeNodeItemProps {\n  node: TreeNode;\n  level: number;\n  selectedIds: string[];\n  onToggle: (node: TreeNode, checked: boolean) => void;\n}\n\nfunction TreeNodeItem({\n  node,\n  level,\n  selectedIds,\n  onToggle,\n}: TreeNodeItemProps) {\n  const [isExpanded, setIsExpanded] = React.useState(true);\n  const hasChildren = node.children && node.children.length > 0;\n  const state = getNodeState(node, selectedIds);\n  const isChecked = state === \"checked\";\n  const isIndeterminate = state === \"indeterminate\";\n\n  const handleChange = () => {\n    onToggle(node, state !== \"checked\");\n  };\n\n  return (\n    <div className=\"flex flex-col\">\n      <div\n        className=\"group flex items-center gap-2 py-1\"\n        style={{ paddingLeft: `${level * 20}px` }}\n      >\n        {hasChildren ? (\n          <button\n            type=\"button\"\n            onClick={() => setIsExpanded(!isExpanded)}\n            className=\"flex h-5 w-5 items-center justify-center rounded text-muted-foreground hover:bg-muted\"\n          >\n            <ChevronRight\n              className={cn(\n                \"size-4 transition-transform duration-200\",\n                isExpanded && \"rotate-90\",\n              )}\n            />\n          </button>\n        ) : (\n          <div className=\"w-5\" />\n        )}\n        <label className=\"inline-flex cursor-pointer items-center gap-2\">\n          <div className=\"relative flex items-center justify-center\">\n            <input\n              type=\"checkbox\"\n              checked={isChecked}\n              onChange={handleChange}\n              className=\"peer sr-only\"\n            />\n            <div\n              className={cn(\n                \"flex h-5 w-5 shrink-0 items-center justify-center rounded-md border-2 transition-all duration-200\",\n                isChecked || isIndeterminate\n                  ? \"border-primary bg-primary text-primary-foreground\"\n                  : \"border-muted-foreground/30 bg-background group-hover:border-muted-foreground/50\",\n              )}\n            >\n              {isChecked && <Check className=\"size-3.5 stroke-[3]\" />}\n              {isIndeterminate && <Minus className=\"size-3.5 stroke-[3]\" />}\n            </div>\n          </div>\n          <span className=\"text-sm font-medium text-foreground\">\n            {node.label}\n          </span>\n        </label>\n      </div>\n      {hasChildren && isExpanded && (\n        <div className=\"flex flex-col\">\n          {node.children!.map((child) => (\n            <TreeNodeItem\n              key={child.id}\n              node={child}\n              level={level + 1}\n              selectedIds={selectedIds}\n              onToggle={onToggle}\n            />\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default function CheckboxTree({\n  nodes,\n  value,\n  defaultValue = [],\n  onValueChange,\n  className,\n}: CheckboxTreeProps) {\n  const [internalValue, setInternalValue] =\n    React.useState<string[]>(defaultValue);\n  const isControlled = value !== undefined;\n  const selectedIds = isControlled ? value : internalValue;\n\n  const handleToggle = (node: TreeNode, checked: boolean) => {\n    const affectedIds = getAllChildIds(node);\n    let newValue: string[];\n\n    if (checked) {\n      newValue = [...new Set([...selectedIds, ...affectedIds])];\n    } else {\n      newValue = selectedIds.filter((id) => !affectedIds.includes(id));\n    }\n\n    if (!isControlled) {\n      setInternalValue(newValue);\n    }\n    onValueChange?.(newValue);\n  };\n\n  return (\n    <div className={cn(\"flex flex-col\", className)}>\n      {nodes.map((node) => (\n        <TreeNodeItem\n          key={node.id}\n          node={node}\n          level={0}\n          selectedIds={selectedIds}\n          onToggle={handleToggle}\n        />\n      ))}\n    </div>\n  );\n}\n\nexport { CheckboxTree, type CheckboxTreeProps, type TreeNode };\n",
      "type": "registry:ui",
      "target": "components/ruixen/checkbox-tree.tsx"
    }
  ]
}