{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "notification-inbox-popover",
  "type": "registry:ui",
  "title": "Notification Inbox Popover",
  "description": "Wave-hover inbox with cosine proximity effect, mark all read, and glass morphism.",
  "dependencies": [
    "motion"
  ],
  "registryDependencies": [],
  "files": [
    {
      "path": "registry/ruixenui/notification-inbox-popover.tsx",
      "content": "\"use client\";\n\nimport { useState, useRef, useCallback, useEffect } from \"react\";\nimport { motion, AnimatePresence } from \"motion/react\";\n\n/**\n * Notification Inbox — Rauno Freiberg craft.\n *\n * Wave-proximity hover: cursor position drives nearby rows to lift,\n * sharpen, and gain weight through cosine falloff — computed per-frame\n * via direct DOM writes, zero re-renders. Hidden scrollbar with\n * edge-mask fading. Staggered mark-all-read cascade.\n * The interaction IS the design.\n */\n\n/* ── Audio — 3ms noise burst singleton ── */\n\nlet _ctx: AudioContext | null = null;\nlet _buf: AudioBuffer | null = null;\n\nfunction getAudio(): AudioContext {\n  if (!_ctx) {\n    _ctx = new (window.AudioContext ||\n      (window as unknown as { webkitAudioContext: typeof AudioContext })\n        .webkitAudioContext)();\n  }\n  if (_ctx.state === \"suspended\") _ctx.resume();\n  return _ctx;\n}\n\nfunction ensureBuf(ac: AudioContext): AudioBuffer {\n  if (_buf && _buf.sampleRate === ac.sampleRate) return _buf;\n  const len = Math.floor(ac.sampleRate * 0.003);\n  const buf = ac.createBuffer(1, len, ac.sampleRate);\n  const ch = buf.getChannelData(0);\n  for (let i = 0; i < len; i++) ch[i] = (Math.random() * 2 - 1) * (1 - i / len) ** 4;\n  _buf = buf;\n  return buf;\n}\n\nfunction tick() {\n  try {\n    const ac = getAudio();\n    const src = ac.createBufferSource();\n    const g = ac.createGain();\n    src.buffer = ensureBuf(ac);\n    g.gain.value = 0.06;\n    src.connect(g).connect(ac.destination);\n    src.start();\n  } catch {\n    /* silent */\n  }\n}\n\n/* ── Types ── */\n\ninterface InboxItem {\n  id: string;\n  title: string;\n  body: string;\n  time: string;\n  read?: boolean;\n}\n\ninterface NotificationInboxPopoverProps {\n  items?: InboxItem[];\n  onMarkRead?: (id: string) => void;\n  onMarkAllRead?: () => void;\n  sound?: boolean;\n}\n\n/* ── Default data ── */\n\nconst SEED: InboxItem[] = [\n  { id: \"1\", title: \"Deployment complete\", body: \"v2.4.1 deployed to production successfully\", time: \"2m\", read: false },\n  { id: \"2\", title: \"Review requested\", body: \"Alex requested your review on PR #482\", time: \"8m\", read: false },\n  { id: \"3\", title: \"Build passed\", body: \"Pipeline #846 completed successfully\", time: \"24m\", read: false },\n  { id: \"4\", title: \"Comment added\", body: \"Sarah commented on your issue #291\", time: \"1h\", read: true },\n  { id: \"5\", title: \"Invitation\", body: \"You were invited to join Team Alpha\", time: \"3h\", read: true },\n  { id: \"6\", title: \"Weekly report\", body: \"Your analytics summary is ready to view\", time: \"6h\", read: true },\n  { id: \"7\", title: \"Security alert\", body: \"New login detected from unknown device\", time: \"1d\", read: false },\n];\n\n/* ── Scoped CSS ── */\n\nconst STYLE = `\n.ni{\n  --ni-glass:rgba(255,255,255,.72);\n  --ni-border:rgba(0,0,0,.06);\n  --ni-shadow:0 0 0 .5px rgba(0,0,0,.04),0 2px 6px rgba(0,0,0,.04),0 8px 28px rgba(0,0,0,.07);\n  --ni-ink:0,0,0;\n  --ni-dot:#007AFF;\n  --ni-dot-bg:rgba(0,122,255,.1)\n}\n.dark .ni,[data-theme=\"dark\"] .ni{\n  --ni-glass:rgba(30,30,32,.82);\n  --ni-border:rgba(255,255,255,.06);\n  --ni-shadow:0 0 0 .5px rgba(255,255,255,.04),0 2px 6px rgba(0,0,0,.18),0 8px 28px rgba(0,0,0,.28);\n  --ni-ink:255,255,255;\n  --ni-dot:#0A84FF;\n  --ni-dot-bg:rgba(10,132,255,.12)\n}\n.ni-list{scrollbar-width:none;-ms-overflow-style:none}\n.ni-list::-webkit-scrollbar{display:none}\n`.replace(/\\n/g, \"\");\n\n/* ── Proximity math ── */\n\nconst RADIUS = 80;\nconst LIFT = 3.5;\nconst SCALE = 0.01;\n\nfunction cosine(cy: number, ry: number): number {\n  const d = Math.abs(cy - ry);\n  return d > RADIUS ? 0 : (1 + Math.cos((d / RADIUS) * Math.PI)) / 2;\n}\n\n/* ── Component ── */\n\nexport function NotificationInboxPopover({\n  items: ext,\n  onMarkRead,\n  onMarkAllRead,\n  sound = true,\n}: NotificationInboxPopoverProps) {\n  const [internal, setInternal] = useState<InboxItem[]>(() => ext ?? SEED);\n  const items = ext ?? internal;\n  const unread = items.filter((n) => !n.read).length;\n\n  const listRef = useRef<HTMLDivElement>(null);\n  const rows = useRef<Map<string, HTMLDivElement>>(new Map());\n  const raf = useRef(0);\n  const cy = useRef<number | null>(null);\n  const hovering = useRef(false);\n\n  /* ── Per-frame proximity — direct DOM, zero re-renders ── */\n\n  const paint = useCallback(() => {\n    const list = listRef.current;\n    if (!list) return;\n\n    const lr = list.getBoundingClientRect();\n    const cursor = cy.current;\n\n    rows.current.forEach((el) => {\n      const rr = el.getBoundingClientRect();\n      const center = rr.top - lr.top + rr.height / 2;\n      const p = cursor !== null ? cosine(cursor, center) : 0;\n\n      /* transform + shadow */\n      el.style.transform =\n        p > 0.01 ? `translateY(${-LIFT * p}px) scale(${1 + SCALE * p})` : \"\";\n      el.style.boxShadow =\n        p > 0.06\n          ? `0 ${(p * 6).toFixed(1)}px ${(p * 16).toFixed(0)}px rgba(var(--ni-ink),${(p * 0.04).toFixed(3)})`\n          : \"none\";\n\n      /* subtle background tint at proximity peak */\n      el.style.background =\n        p > 0.1 ? `rgba(var(--ni-ink),${(p * 0.022).toFixed(3)})` : \"\";\n\n      /* title weight + opacity */\n      const isRead = el.dataset.read === \"1\";\n      const t = el.querySelector(\"[data-t]\") as HTMLElement | null;\n      if (t) {\n        t.style.fontWeight = String(Math.round((isRead ? 400 : 480) + p * 80));\n        t.style.color = `rgba(var(--ni-ink),${(isRead ? 0.34 + p * 0.24 : 0.6 + p * 0.28).toFixed(2)})`;\n      }\n\n      /* body opacity */\n      const b = el.querySelector(\"[data-b]\") as HTMLElement | null;\n      if (b) {\n        b.style.color = `rgba(var(--ni-ink),${(0.32 + p * 0.13).toFixed(2)})`;\n      }\n    });\n\n    if (hovering.current) raf.current = requestAnimationFrame(paint);\n  }, []);\n\n  /* ── Mouse handlers — ref writes only, no setState ── */\n\n  const onMove = useCallback(\n    (e: React.MouseEvent) => {\n      const lr = listRef.current?.getBoundingClientRect();\n      if (!lr) return;\n      cy.current = e.clientY - lr.top;\n      if (!hovering.current) {\n        hovering.current = true;\n        raf.current = requestAnimationFrame(paint);\n      }\n    },\n    [paint],\n  );\n\n  const onLeave = useCallback(() => {\n    hovering.current = false;\n    cy.current = null;\n    cancelAnimationFrame(raf.current);\n    /* reset every row to neutral */\n    rows.current.forEach((el) => {\n      el.style.transform = \"\";\n      el.style.boxShadow = \"none\";\n      el.style.background = \"\";\n      const t = el.querySelector(\"[data-t]\") as HTMLElement | null;\n      const b = el.querySelector(\"[data-b]\") as HTMLElement | null;\n      if (t) { t.style.fontWeight = \"\"; t.style.color = \"\"; }\n      if (b) b.style.color = \"\";\n    });\n  }, []);\n\n  /* cleanup on unmount */\n  useEffect(() => () => cancelAnimationFrame(raf.current), []);\n\n  /* ── Actions ── */\n\n  const markRead = useCallback(\n    (id: string) => {\n      if (sound) tick();\n      if (ext) {\n        onMarkRead?.(id);\n      } else {\n        setInternal((p) => p.map((n) => (n.id === id ? { ...n, read: true } : n)));\n        onMarkRead?.(id);\n      }\n    },\n    [ext, onMarkRead, sound],\n  );\n\n  const markAllRead = useCallback(() => {\n    if (sound) tick();\n    if (ext) {\n      onMarkAllRead?.();\n    } else {\n      const ids = items.filter((n) => !n.read).map((n) => n.id);\n      ids.forEach((id, i) => {\n        setTimeout(() => {\n          setInternal((p) => p.map((n) => (n.id === id ? { ...n, read: true } : n)));\n          if (sound && i > 0) tick();\n        }, i * 40);\n      });\n      onMarkAllRead?.();\n    }\n  }, [ext, items, onMarkAllRead, sound]);\n\n  return (\n    <div\n      className=\"ni\"\n      style={{\n        width: 340,\n        borderRadius: 14,\n        background: \"var(--ni-glass)\",\n        border: \"1px solid var(--ni-border)\",\n        boxShadow: \"var(--ni-shadow)\",\n        backdropFilter: \"blur(20px)\",\n        WebkitBackdropFilter: \"blur(20px)\",\n        overflow: \"hidden\",\n      }}\n    >\n      <style dangerouslySetInnerHTML={{ __html: STYLE }} />\n\n      {/* ── Header ── */}\n      <div\n        style={{\n          display: \"flex\",\n          alignItems: \"center\",\n          justifyContent: \"space-between\",\n          padding: \"14px 16px 11px\",\n        }}\n      >\n        <div style={{ display: \"flex\", alignItems: \"center\", gap: 7 }}>\n          <span\n            style={{\n              fontSize: 13,\n              fontWeight: 600,\n              color: \"rgba(var(--ni-ink),.88)\",\n              letterSpacing: \"-0.01em\",\n            }}\n          >\n            Inbox\n          </span>\n          <AnimatePresence>\n            {unread > 0 && (\n              <motion.span\n                initial={{ scale: 0.6, opacity: 0 }}\n                animate={{ scale: 1, opacity: 1 }}\n                exit={{ scale: 0.6, opacity: 0 }}\n                transition={{ type: \"spring\", stiffness: 500, damping: 30 }}\n                style={{\n                  fontSize: 10,\n                  fontWeight: 560,\n                  color: \"var(--ni-dot)\",\n                  background: \"var(--ni-dot-bg)\",\n                  padding: \"1px 6px\",\n                  borderRadius: 999,\n                  letterSpacing: \"0.02em\",\n                  fontVariantNumeric: \"tabular-nums\",\n                }}\n              >\n                {unread}\n              </motion.span>\n            )}\n          </AnimatePresence>\n        </div>\n        <AnimatePresence>\n          {unread > 0 && (\n            <motion.button\n              initial={{ opacity: 0, x: 6 }}\n              animate={{ opacity: 1, x: 0 }}\n              exit={{ opacity: 0, x: 6 }}\n              transition={{ type: \"spring\", stiffness: 400, damping: 28 }}\n              onClick={markAllRead}\n              style={{\n                background: \"none\",\n                border: \"none\",\n                cursor: \"pointer\",\n                fontSize: 11,\n                fontWeight: 440,\n                color: \"rgba(var(--ni-ink),.34)\",\n                letterSpacing: \"0.01em\",\n                padding: 0,\n                transition: \"color .15s\",\n              }}\n              onMouseEnter={(e) => {\n                e.currentTarget.style.color = \"rgba(var(--ni-ink),.88)\";\n              }}\n              onMouseLeave={(e) => {\n                e.currentTarget.style.color = \"rgba(var(--ni-ink),.34)\";\n              }}\n            >\n              Mark all read\n            </motion.button>\n          )}\n        </AnimatePresence>\n      </div>\n\n      {/* hairline */}\n      <div\n        style={{\n          height: 0.5,\n          background: \"rgba(var(--ni-ink),.06)\",\n          marginLeft: 16,\n          marginRight: 16,\n        }}\n      />\n\n      {/* ── List — hidden scrollbar, edge mask ── */}\n      <div\n        ref={listRef}\n        className=\"ni-list\"\n        onMouseMove={onMove}\n        onMouseLeave={onLeave}\n        style={{\n          maxHeight: 380,\n          overflowY: \"auto\",\n          padding: \"2px 0 4px\",\n          maskImage:\n            \"linear-gradient(to bottom,transparent,black 10px,black calc(100% - 10px),transparent)\",\n          WebkitMaskImage:\n            \"linear-gradient(to bottom,transparent,black 10px,black calc(100% - 10px),transparent)\",\n        }}\n      >\n        <AnimatePresence initial={false}>\n          {items.map((item, i) => (\n            <motion.div\n              key={item.id}\n              layout\n              initial={{ opacity: 0, height: 0 }}\n              animate={{ opacity: 1, height: \"auto\" }}\n              exit={{ opacity: 0, height: 0, transition: { height: { delay: 0.08 } } }}\n              transition={{ type: \"spring\", stiffness: 400, damping: 32 }}\n            >\n              <div\n                data-read={item.read ? \"1\" : \"0\"}\n                ref={(el) => {\n                  if (el) rows.current.set(item.id, el);\n                  else rows.current.delete(item.id);\n                }}\n                onClick={() => !item.read && markRead(item.id)}\n                style={{\n                  position: \"relative\",\n                  padding: \"10px 16px\",\n                  cursor: item.read ? \"default\" : \"pointer\",\n                  display: \"flex\",\n                  alignItems: \"flex-start\",\n                  gap: 9,\n                  borderBottom:\n                    i < items.length - 1\n                      ? \"0.5px solid rgba(var(--ni-ink),.05)\"\n                      : \"none\",\n                  borderRadius: 8,\n                  margin: \"0 4px\",\n                  willChange: \"transform\",\n                  transition: \"transform .12s,box-shadow .1s,background .1s\",\n                }}\n              >\n                {/* unread dot */}\n                <div\n                  style={{\n                    width: 6,\n                    minWidth: 6,\n                    height: 6,\n                    marginTop: 5,\n                    position: \"relative\",\n                  }}\n                >\n                  <AnimatePresence>\n                    {!item.read && (\n                      <motion.div\n                        initial={{ scale: 1, opacity: 1 }}\n                        exit={{ scale: 0, opacity: 0 }}\n                        transition={{ type: \"spring\", stiffness: 500, damping: 28 }}\n                        style={{\n                          width: 6,\n                          height: 6,\n                          borderRadius: \"50%\",\n                          background: \"var(--ni-dot)\",\n                          position: \"absolute\",\n                          inset: 0,\n                        }}\n                      />\n                    )}\n                  </AnimatePresence>\n                </div>\n\n                {/* content */}\n                <div style={{ flex: 1, minWidth: 0 }}>\n                  <div\n                    data-t=\"\"\n                    style={{\n                      fontSize: 13,\n                      fontWeight: item.read ? 400 : 480,\n                      color: `rgba(var(--ni-ink),${item.read ? 0.34 : 0.6})`,\n                      lineHeight: 1.35,\n                      letterSpacing: \"-0.005em\",\n                      transition: \"color .12s,font-weight .12s\",\n                    }}\n                  >\n                    {item.title}\n                  </div>\n                  <div\n                    data-b=\"\"\n                    style={{\n                      fontSize: 12,\n                      fontWeight: 400,\n                      color: \"rgba(var(--ni-ink),.32)\",\n                      lineHeight: 1.4,\n                      marginTop: 1,\n                      overflow: \"hidden\",\n                      textOverflow: \"ellipsis\",\n                      whiteSpace: \"nowrap\",\n                      transition: \"color .12s\",\n                    }}\n                  >\n                    {item.body}\n                  </div>\n                </div>\n\n                {/* time */}\n                <span\n                  style={{\n                    fontSize: 11,\n                    fontWeight: 400,\n                    color: \"rgba(var(--ni-ink),.24)\",\n                    letterSpacing: \"0.01em\",\n                    flexShrink: 0,\n                    marginTop: 1,\n                    fontVariantNumeric: \"tabular-nums\",\n                  }}\n                >\n                  {item.time}\n                </span>\n              </div>\n            </motion.div>\n          ))}\n        </AnimatePresence>\n      </div>\n    </div>\n  );\n}\n\nexport default NotificationInboxPopover;\n",
      "type": "registry:ui",
      "target": "components/ruixen/notification-inbox-popover.tsx"
    }
  ]
}