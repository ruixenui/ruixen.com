{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "reorderable-table",
  "type": "registry:ui",
  "title": "Reorderable Table",
  "description": "Glass table with drag-and-drop column reordering, visibility popover, search, and localStorage persistence. Spring animations on reorder.",
  "dependencies": [
    "motion"
  ],
  "files": [
    {
      "path": "registry/ruixenui/reorderable-table.tsx",
      "content": "\"use client\";\n\nimport { useState, useRef, useMemo, useEffect, useCallback } from \"react\";\nimport { motion, AnimatePresence } from \"motion/react\";\n\n/**\n * Reorderable Table — Rauno Freiberg craft.\n *\n * Glass table with drag-and-drop column reordering.\n * Column visibility popover with checkboxes. Search bar.\n * Spring animations on reorder. Audio tick on drag.\n * Layout persisted to localStorage.\n */\n\n/* ── Audio ── */\n\nlet _a: AudioContext | null = null;\nlet _b: AudioBuffer | null = null;\nfunction getCtx(): AudioContext {\n  if (!_a) _a = new (window.AudioContext || (window as unknown as { webkitAudioContext: typeof AudioContext }).webkitAudioContext)();\n  if (_a.state === \"suspended\") _a.resume();\n  return _a;\n}\nfunction getBuf(ac: AudioContext): AudioBuffer {\n  if (_b && _b.sampleRate === ac.sampleRate) return _b;\n  const len = Math.floor(ac.sampleRate * 0.003);\n  const buf = ac.createBuffer(1, len, ac.sampleRate);\n  const ch = buf.getChannelData(0);\n  for (let i = 0; i < len; i++) ch[i] = (Math.random() * 2 - 1) * (1 - i / len) ** 4;\n  _b = buf; return buf;\n}\nfunction tick(ref: React.MutableRefObject<number>) {\n  const now = performance.now();\n  if (now - ref.current < 25) return;\n  ref.current = now;\n  try { const ac = getCtx(); const s = ac.createBufferSource(); const g = ac.createGain(); s.buffer = getBuf(ac); g.gain.value = 0.06; s.connect(g).connect(ac.destination); s.start(); } catch { /* silent */ }\n}\n\n/* ── Types ── */\n\nexport type ReorderableRow = Record<string, unknown>;\n\nexport interface ColumnDef<T = ReorderableRow> {\n  key: keyof T | (string & {});\n  label: string;\n  render?: (row: T) => React.ReactNode;\n}\n\ninterface ReorderableTableProps<T extends ReorderableRow> {\n  data?: T[];\n  columns?: ColumnDef<T>[];\n  lsOrderKey?: string;\n  lsVisibleKey?: string;\n  searchable?: boolean;\n  sound?: boolean;\n}\n\n/* ── Default data ── */\n\ntype DefaultRow = { id: number; name: string; email: string; role: string; location: string; status: string; balance: number };\n\nconst DEFAULT_ROWS: DefaultRow[] = [\n  { id: 1, name: \"Arjun Mehta\", email: \"arjun.mehta@company.com\", role: \"Manager\", location: \"Bangalore\", status: \"Active\", balance: 1250 },\n  { id: 2, name: \"Hannah Park\", email: \"hannah.park@company.com\", role: \"Designer\", location: \"Seoul\", status: \"Active\", balance: 600 },\n  { id: 3, name: \"Oliver Scott\", email: \"oliver.scott@company.com\", role: \"Engineer\", location: \"Manchester\", status: \"Inactive\", balance: 650 },\n  { id: 4, name: \"Camila Torres\", email: \"camila.torres@company.com\", role: \"HR\", location: \"Bogotá\", status: \"Active\", balance: 0 },\n  { id: 5, name: \"Kenji Tanaka\", email: \"kenji.tanaka@company.com\", role: \"Developer\", location: \"Osaka\", status: \"Suspended\", balance: -1000 },\n];\n\nconst DEFAULT_COLS: ColumnDef<DefaultRow>[] = [\n  { key: \"name\", label: \"Name\" },\n  { key: \"email\", label: \"Email\" },\n  { key: \"role\", label: \"Role\" },\n  { key: \"location\", label: \"Location\" },\n  {\n    key: \"status\", label: \"Status\",\n    render: (row) => {\n      const c = row.status === \"Active\" ? \"#34C759\" : row.status === \"Inactive\" ? \"rgba(var(--t-ink),.3)\" : \"#FF3B30\";\n      return (\n        <span style={{ display: \"inline-flex\", alignItems: \"center\", gap: 6 }}>\n          <span style={{ width: 6, height: 6, borderRadius: \"50%\", background: c }} />\n          <span>{row.status}</span>\n        </span>\n      );\n    },\n  },\n  { key: \"balance\", label: \"Balance\", render: (row) => `$${row.balance.toLocaleString()}` },\n];\n\n/* ── CSS ── */\n\nconst CSS = `.rt{--t-bg:rgba(255,255,255,.72);--t-border:rgba(0,0,0,.06);--t-shadow:0 0 0 .5px rgba(0,0,0,.04),0 2px 4px rgba(0,0,0,.04),0 8px 24px rgba(0,0,0,.06);--t-ink:0,0,0}.dark .rt,[data-theme=\"dark\"] .rt{--t-bg:rgba(30,30,32,.82);--t-border:rgba(255,255,255,.06);--t-shadow:0 0 0 .5px rgba(255,255,255,.04),0 2px 4px rgba(0,0,0,.2),0 8px 24px rgba(0,0,0,.3);--t-ink:255,255,255}.rt-row{transition:background .1s}.rt-row:hover{background:rgba(var(--t-ink),.03)}.rt-inp{background:rgba(var(--t-ink),.03);border:1px solid rgba(var(--t-ink),.08);border-radius:8px;padding:7px 12px;font-size:12px;font-weight:420;color:rgba(var(--t-ink),.8);outline:none;transition:border-color .15s}.rt-inp:focus{border-color:rgba(var(--t-ink),.2)}.rt-inp::placeholder{color:rgba(var(--t-ink),.25)}`;\n\nconst TH: React.CSSProperties = {\n  padding: \"10px 16px\", fontSize: 11, fontWeight: 520,\n  color: \"rgba(var(--t-ink),.4)\", letterSpacing: \"0.04em\",\n  textTransform: \"uppercase\", textAlign: \"left\", whiteSpace: \"nowrap\",\n  borderBottom: \"1px solid var(--t-border)\", cursor: \"grab\",\n  userSelect: \"none\",\n};\n\nconst TD: React.CSSProperties = {\n  padding: \"10px 16px\", fontSize: 13, fontWeight: 420,\n  color: \"rgba(var(--t-ink),.7)\",\n  borderBottom: \"1px solid rgba(var(--t-ink),.03)\", whiteSpace: \"nowrap\",\n  overflow: \"hidden\", textOverflow: \"ellipsis\",\n};\n\n/* ── Component ── */\n\nexport function ReorderableTable<T extends ReorderableRow>({\n  data = DEFAULT_ROWS as unknown as T[],\n  columns = DEFAULT_COLS as unknown as ColumnDef<T>[],\n  lsOrderKey = \"reorderable_table_order_v1\",\n  lsVisibleKey = \"reorderable_table_visible_v1\",\n  searchable = true,\n  sound = true,\n}: ReorderableTableProps<T>) {\n  const columnKeys = useMemo(() => columns.map((c) => String(c.key)), [columns]);\n  const columnKeysStr = columnKeys.join(\",\");\n\n  const [query, setQuery] = useState(\"\");\n  const [showColMenu, setShowColMenu] = useState(false);\n  const [dragOver, setDragOver] = useState<number | null>(null);\n  const lastSound = useRef(0);\n  const dragSrc = useRef<number | null>(null);\n\n  const [columnOrder, setColumnOrder] = useState<string[]>(() => {\n    if (typeof window === \"undefined\") return columnKeys;\n    return JSON.parse(localStorage.getItem(lsOrderKey) || \"null\") || columnKeys;\n  });\n\n  const [visible, setVisible] = useState<Record<string, boolean>>(() => {\n    if (typeof window === \"undefined\") {\n      const initial: Record<string, boolean> = {};\n      columnKeys.forEach((k) => (initial[k] = true));\n      return initial;\n    }\n    const saved = JSON.parse(localStorage.getItem(lsVisibleKey) || \"null\");\n    if (saved) return saved;\n    const initial: Record<string, boolean> = {};\n    columnKeys.forEach((k) => (initial[k] = true));\n    return initial;\n  });\n\n  /* Persist */\n  useEffect(() => {\n    if (typeof window !== \"undefined\") localStorage.setItem(lsOrderKey, JSON.stringify(columnOrder));\n  }, [columnOrder, lsOrderKey]);\n\n  useEffect(() => {\n    if (typeof window !== \"undefined\") localStorage.setItem(lsVisibleKey, JSON.stringify(visible));\n  }, [visible, lsVisibleKey]);\n\n  /* Sync with columns prop */\n  useEffect(() => {\n    setColumnOrder((prev) => {\n      const missing = columnKeys.filter((k) => !prev.includes(k));\n      return [...prev.filter((k) => columnKeys.includes(k)), ...missing];\n    });\n  }, [columnKeysStr]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  const orderedColumns = useMemo(\n    () => columnOrder.map((k) => columns.find((c) => String(c.key) === k)).filter(Boolean) as ColumnDef<T>[],\n    [columnOrder, columns],\n  );\n\n  const visibleCols = useMemo(\n    () => orderedColumns.filter((c) => visible[String(c.key)]),\n    [orderedColumns, visible],\n  );\n\n  /* Search */\n  const filtered = useMemo(() => {\n    if (!query) return data;\n    const q = query.toLowerCase();\n    return data.filter((r) => Object.values(r).some((v) => String(v).toLowerCase().includes(q)));\n  }, [data, query]);\n\n  /* Drag & Drop */\n  const onDragStart = useCallback((e: React.DragEvent, i: number) => {\n    dragSrc.current = i;\n    e.dataTransfer.effectAllowed = \"move\";\n  }, []);\n\n  const onDrop = useCallback((e: React.DragEvent, i: number) => {\n    e.preventDefault();\n    setDragOver(null);\n    const src = dragSrc.current;\n    if (src === null || src === i) return;\n    if (sound) tick(lastSound);\n    setColumnOrder((prev) => {\n      const visCols = prev.filter((k) => visible[k]);\n      const srcKey = visCols[src];\n      const destKey = visCols[i];\n      const srcIdx = prev.indexOf(srcKey);\n      const destIdx = prev.indexOf(destKey);\n      const next = [...prev];\n      next.splice(srcIdx, 1);\n      next.splice(destIdx, 0, srcKey);\n      return next;\n    });\n    dragSrc.current = null;\n  }, [sound, visible]);\n\n  const toggleVisible = useCallback((key: string) => {\n    setVisible((prev) => ({ ...prev, [key]: !prev[key] }));\n    if (sound) tick(lastSound);\n  }, [sound]);\n\n  const resetLayout = useCallback(() => {\n    setColumnOrder(columnKeys);\n    const all: Record<string, boolean> = {};\n    columnKeys.forEach((k) => (all[k] = true));\n    setVisible(all);\n    localStorage.removeItem(lsOrderKey);\n    localStorage.removeItem(lsVisibleKey);\n    if (sound) tick(lastSound);\n  }, [columnKeys, lsOrderKey, lsVisibleKey, sound]);\n\n  return (\n    <div className=\"rt\" style={{\n      width: \"100%\", maxWidth: 800,\n      background: \"var(--t-bg)\", border: \"1px solid var(--t-border)\",\n      boxShadow: \"var(--t-shadow)\", borderRadius: 14,\n      backdropFilter: \"blur(16px)\", WebkitBackdropFilter: \"blur(16px)\",\n      overflow: \"hidden\",\n    }}>\n      <style dangerouslySetInnerHTML={{ __html: CSS }} />\n\n      {/* Header bar */}\n      <div style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\", padding: \"12px 16px\", gap: 8 }}>\n        <span style={{ fontSize: 13, fontWeight: 560, color: \"rgba(var(--t-ink),.85)\", letterSpacing: \"-0.01em\" }}>\n          Team\n        </span>\n        <div style={{ display: \"flex\", gap: 6, alignItems: \"center\" }}>\n          {searchable && (\n            <input\n              className=\"rt-inp\"\n              placeholder=\"Search...\"\n              value={query}\n              onChange={(e) => setQuery(e.target.value)}\n              style={{ width: 160 }}\n            />\n          )}\n          <div style={{ position: \"relative\" }}>\n            <button\n              onClick={() => setShowColMenu(!showColMenu)}\n              style={{\n                border: \"none\", background: \"rgba(var(--t-ink),.04)\", padding: \"5px 10px\",\n                borderRadius: 6, fontSize: 11, fontWeight: 500, color: \"rgba(var(--t-ink),.5)\",\n                cursor: \"pointer\",\n              }}\n            >\n              Columns\n            </button>\n            <AnimatePresence>\n              {showColMenu && (\n                <motion.div\n                  initial={{ opacity: 0, y: -4, scale: 0.96 }}\n                  animate={{ opacity: 1, y: 0, scale: 1 }}\n                  exit={{ opacity: 0, y: -4, scale: 0.96 }}\n                  transition={{ type: \"spring\", stiffness: 500, damping: 30 }}\n                  style={{\n                    position: \"absolute\", right: 0, top: \"calc(100% + 4px)\", zIndex: 20,\n                    background: \"var(--t-bg)\", border: \"1px solid var(--t-border)\",\n                    boxShadow: \"var(--t-shadow)\", borderRadius: 10, padding: \"6px 0\",\n                    minWidth: 150, backdropFilter: \"blur(16px)\", WebkitBackdropFilter: \"blur(16px)\",\n                  }}\n                >\n                  {columns.map((col) => {\n                    const k = String(col.key);\n                    const isVis = visible[k];\n                    return (\n                      <button\n                        key={k}\n                        onClick={() => toggleVisible(k)}\n                        style={{\n                          display: \"flex\", alignItems: \"center\", gap: 8, width: \"100%\",\n                          padding: \"6px 12px\", border: \"none\", background: \"none\",\n                          cursor: \"pointer\", fontSize: 12, fontWeight: 450,\n                          color: isVis ? \"rgba(var(--t-ink),.7)\" : \"rgba(var(--t-ink),.3)\",\n                          textAlign: \"left\",\n                        }}\n                      >\n                        <span style={{\n                          width: 14, height: 14, borderRadius: 4,\n                          border: `1.5px solid rgba(var(--t-ink),${isVis ? \".3\" : \".12\"})`,\n                          display: \"flex\", alignItems: \"center\", justifyContent: \"center\",\n                        }}>\n                          {isVis && (\n                            <svg width=\"8\" height=\"8\" viewBox=\"0 0 8 8\"><path d=\"M1.5 4L3 5.5L6.5 2\" stroke=\"currentColor\" strokeWidth=\"1.2\" fill=\"none\" strokeLinecap=\"round\" /></svg>\n                          )}\n                        </span>\n                        {col.label}\n                      </button>\n                    );\n                  })}\n                  <div style={{ borderTop: \"1px solid rgba(var(--t-ink),.06)\", marginTop: 4, paddingTop: 4 }}>\n                    <button\n                      onClick={resetLayout}\n                      style={{\n                        display: \"block\", width: \"100%\", padding: \"6px 12px\",\n                        border: \"none\", background: \"none\", cursor: \"pointer\",\n                        fontSize: 11, fontWeight: 500, color: \"rgba(var(--t-ink),.4)\",\n                        textAlign: \"left\",\n                      }}\n                    >\n                      Reset layout\n                    </button>\n                  </div>\n                </motion.div>\n              )}\n            </AnimatePresence>\n          </div>\n        </div>\n      </div>\n\n      {/* Click-away */}\n      {showColMenu && <div onClick={() => setShowColMenu(false)} style={{ position: \"fixed\", inset: 0, zIndex: 15 }} />}\n\n      {/* Table */}\n      <div style={{ overflowX: \"auto\" }}>\n        <table style={{ width: \"100%\", borderCollapse: \"collapse\" }}>\n          <thead>\n            <tr>\n              {visibleCols.map((col, idx) => (\n                <th\n                  key={String(col.key)}\n                  draggable\n                  onDragStart={(e) => onDragStart(e, idx)}\n                  onDragOver={(e) => { e.preventDefault(); setDragOver(idx); }}\n                  onDragLeave={() => setDragOver(null)}\n                  onDrop={(e) => onDrop(e, idx)}\n                  style={{\n                    ...TH,\n                    background: dragOver === idx ? \"rgba(var(--t-ink),.04)\" : undefined,\n                    transition: \"background .12s\",\n                  }}\n                >\n                  <div style={{ display: \"flex\", alignItems: \"center\", gap: 6 }}>\n                    <svg width=\"10\" height=\"10\" viewBox=\"0 0 10 10\" style={{ opacity: 0.25, flexShrink: 0 }}>\n                      <circle cx=\"3\" cy=\"3\" r=\"1\" fill=\"currentColor\" /><circle cx=\"7\" cy=\"3\" r=\"1\" fill=\"currentColor\" />\n                      <circle cx=\"3\" cy=\"7\" r=\"1\" fill=\"currentColor\" /><circle cx=\"7\" cy=\"7\" r=\"1\" fill=\"currentColor\" />\n                    </svg>\n                    {col.label}\n                  </div>\n                </th>\n              ))}\n            </tr>\n          </thead>\n          <tbody>\n            {filtered.map((row, i) => (\n              <motion.tr\n                key={String((row as Record<string, unknown>).id ?? i)}\n                className=\"rt-row\"\n                layout\n                initial={{ opacity: 0, y: -4 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ type: \"spring\", stiffness: 400, damping: 30, delay: i * 0.02 }}\n              >\n                {visibleCols.map((col, ci) => (\n                  <td key={String(col.key)} style={{\n                    ...TD,\n                    fontWeight: ci === 0 ? 500 : TD.fontWeight,\n                    color: ci === 0 ? \"rgba(var(--t-ink),.85)\" : TD.color,\n                  }}>\n                    {col.render ? col.render(row) : String((row as Record<string, unknown>)[String(col.key)] ?? \"\")}\n                  </td>\n                ))}\n              </motion.tr>\n            ))}\n          </tbody>\n        </table>\n      </div>\n\n      {/* Footer */}\n      <div style={{\n        display: \"flex\", justifyContent: \"space-between\", padding: \"10px 16px\",\n        borderTop: \"1px solid var(--t-border)\",\n      }}>\n        <span style={{ fontSize: 11, fontWeight: 450, color: \"rgba(var(--t-ink),.35)\" }}>\n          {filtered.length} rows\n        </span>\n        <span style={{ fontSize: 11, fontWeight: 450, color: \"rgba(var(--t-ink),.35)\" }}>\n          {visibleCols.length}/{columns.length} columns\n        </span>\n      </div>\n    </div>\n  );\n}\n\nexport default ReorderableTable;\n",
      "type": "registry:ui",
      "target": "components/ruixen/reorderable-table.tsx"
    }
  ]
}