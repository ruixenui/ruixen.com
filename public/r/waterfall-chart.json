{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "waterfall-chart",
  "type": "registry:ui",
  "title": "Waterfall Chart",
  "description": "A versatile waterfall chart component for visualizing cumulative effects, financial changes, and sequential data with multiple variants and tooltip styles.",
  "dependencies": [
    "recharts"
  ],
  "files": [
    {
      "path": "registry/ruixenui/waterfall-chart.tsx",
      "content": "\"use client\";\n\nimport * as React from \"react\";\nimport {\n  BarChart,\n  Bar,\n  Cell,\n  XAxis,\n  YAxis,\n  Tooltip,\n  ResponsiveContainer,\n  ReferenceLine,\n  LabelList,\n  CartesianGrid,\n} from \"recharts\";\n\nimport { cn } from \"@/lib/utils\";\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface WaterfallDataItem {\n  name: string;\n  value: number;\n  isTotal?: boolean;\n}\n\nexport type TooltipIndicator = \"dot\" | \"line\" | \"dashed\";\n\nexport interface WaterfallChartBaseProps {\n  data: WaterfallDataItem[];\n  className?: string;\n  showTooltip?: boolean;\n  tooltipIndicator?: TooltipIndicator;\n  valueFormatter?: (value: number) => string;\n  barSize?: number;\n}\n\n// ============================================================================\n// Color Palette (shadcn chart style - blue theme)\n// ============================================================================\n\nconst COLORS = {\n  positive: \"#2b7fff\", // Primary blue\n  negative: \"#8ec5ff\", // Light blue\n  total: \"#2b7fff\", // Primary blue for totals\n};\n\n// ============================================================================\n// Utility Functions\n// ============================================================================\n\nfunction defaultValueFormatter(value: number): string {\n  if (Math.abs(value) >= 1000000) {\n    return `${(value / 1000000).toFixed(1)}M`;\n  }\n  if (Math.abs(value) >= 1000) {\n    return `${(value / 1000).toFixed(1)}K`;\n  }\n  return value.toLocaleString();\n}\n\n// Transform data for waterfall visualization\nfunction transformWaterfallData(data: WaterfallDataItem[]) {\n  let cumulative = 0;\n\n  return data.map((item) => {\n    if (item.isTotal) {\n      const result = {\n        name: item.name,\n        value: item.value,\n        start: 0,\n        end: item.value,\n        isTotal: true,\n        isPositive: item.value >= 0,\n        displayValue: item.value,\n      };\n      cumulative = item.value;\n      return result;\n    }\n\n    const start = cumulative;\n    const end = cumulative + item.value;\n    cumulative = end;\n\n    return {\n      name: item.name,\n      value: Math.abs(item.value),\n      start: Math.min(start, end),\n      end: Math.max(start, end),\n      isTotal: false,\n      isPositive: item.value >= 0,\n      displayValue: item.value,\n    };\n  });\n}\n\n// ============================================================================\n// Custom Tooltip Component (shadcn style with indicator variants)\n// ============================================================================\n\ninterface ChartTooltipProps {\n  active?: boolean;\n  payload?: Array<{\n    payload: {\n      name: string;\n      displayValue: number;\n      isTotal: boolean;\n      isPositive: boolean;\n    };\n  }>;\n  indicator?: TooltipIndicator;\n  valueFormatter: (value: number) => string;\n}\n\nfunction ChartTooltip({\n  active,\n  payload,\n  indicator = \"dot\",\n  valueFormatter,\n}: ChartTooltipProps) {\n  if (!active || !payload?.length) return null;\n\n  const data = payload[0].payload;\n  const indicatorColor = data.isTotal\n    ? COLORS.total\n    : data.isPositive\n      ? COLORS.positive\n      : COLORS.negative;\n\n  return (\n    <div className=\"rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\">\n      <div className=\"grid gap-1.5\">\n        <div\n          className={cn(\n            \"flex w-full items-stretch gap-2\",\n            indicator === \"dot\" && \"items-center\",\n          )}\n        >\n          <div\n            className={cn(\"shrink-0 rounded-[2px]\", {\n              \"h-2.5 w-2.5\": indicator === \"dot\",\n              \"w-1 self-stretch\": indicator === \"line\",\n              \"w-0 border-[1.5px] border-dashed bg-transparent self-stretch\":\n                indicator === \"dashed\",\n            })}\n            style={{\n              backgroundColor:\n                indicator !== \"dashed\" ? indicatorColor : undefined,\n              borderColor: indicator === \"dashed\" ? indicatorColor : undefined,\n            }}\n          />\n          <div className=\"flex flex-1 justify-between items-center gap-4\">\n            <span className=\"text-muted-foreground\">{data.name}</span>\n            <span className=\"font-mono font-medium tabular-nums text-foreground\">\n              {data.isTotal ? \"\" : data.displayValue >= 0 ? \"+\" : \"\"}\n              {valueFormatter(data.displayValue)}\n            </span>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// ============================================================================\n// Legend Component\n// ============================================================================\n\ninterface ChartLegendProps {\n  className?: string;\n  showTotal?: boolean;\n}\n\nfunction ChartLegend({ className, showTotal = true }: ChartLegendProps) {\n  const items = [\n    { name: \"Increase\", color: COLORS.positive },\n    { name: \"Decrease\", color: COLORS.negative },\n    ...(showTotal ? [{ name: \"Total\", color: COLORS.total }] : []),\n  ];\n\n  return (\n    <div className={cn(\"flex items-center justify-center gap-4\", className)}>\n      {items.map((item, index) => (\n        <div key={index} className=\"flex items-center gap-1.5\">\n          <div\n            className=\"h-2.5 w-2.5 shrink-0 rounded-[2px]\"\n            style={{ backgroundColor: item.color }}\n          />\n          <span className=\"text-sm text-muted-foreground\">{item.name}</span>\n        </div>\n      ))}\n    </div>\n  );\n}\n\n// ============================================================================\n// 1. Waterfall Chart - Default\n// ============================================================================\n\ninterface WaterfallChartProps extends WaterfallChartBaseProps {\n  showXAxis?: boolean;\n  showYAxis?: boolean;\n  showGrid?: boolean;\n}\n\nfunction WaterfallChart({\n  data,\n  className,\n  showTooltip = true,\n  tooltipIndicator = \"dot\",\n  valueFormatter = defaultValueFormatter,\n  showXAxis = true,\n  showYAxis = true,\n  showGrid = true,\n  barSize,\n}: WaterfallChartProps) {\n  const chartData = transformWaterfallData(data);\n\n  return (\n    <div className={cn(\"w-full\", className)}>\n      <ResponsiveContainer width=\"100%\" height=\"100%\">\n        <BarChart\n          data={chartData}\n          barGap={0}\n          barCategoryGap=\"20%\"\n          barSize={barSize}\n        >\n          {showGrid && (\n            <CartesianGrid\n              strokeDasharray=\"3 3\"\n              vertical={false}\n              stroke=\"var(--color-border)\"\n            />\n          )}\n          {showXAxis && (\n            <XAxis\n              dataKey=\"name\"\n              tickLine={false}\n              axisLine={false}\n              tick={{ fill: \"var(--color-muted-foreground)\", fontSize: 12 }}\n              tickMargin={8}\n              interval={0}\n            />\n          )}\n          {showYAxis && (\n            <YAxis\n              tickLine={false}\n              axisLine={false}\n              tick={{ fill: \"var(--color-muted-foreground)\", fontSize: 12 }}\n              tickFormatter={valueFormatter}\n              width={60}\n            />\n          )}\n          <ReferenceLine y={0} stroke=\"var(--color-border)\" />\n          {showTooltip && (\n            <Tooltip\n              content={\n                <ChartTooltip\n                  indicator={tooltipIndicator}\n                  valueFormatter={valueFormatter}\n                />\n              }\n              cursor={false}\n            />\n          )}\n          <Bar\n            dataKey=\"start\"\n            stackId=\"waterfall\"\n            fill=\"transparent\"\n            radius={0}\n          />\n          <Bar dataKey=\"value\" stackId=\"waterfall\" radius={[4, 4, 0, 0]}>\n            {chartData.map((entry, index) => (\n              <Cell\n                key={`cell-${index}`}\n                fill={\n                  entry.isTotal\n                    ? COLORS.total\n                    : entry.isPositive\n                      ? COLORS.positive\n                      : COLORS.negative\n                }\n              />\n            ))}\n          </Bar>\n        </BarChart>\n      </ResponsiveContainer>\n    </div>\n  );\n}\n\n// ============================================================================\n// 2. Waterfall Chart - Label\n// ============================================================================\n\ninterface WaterfallLabelChartProps extends WaterfallChartBaseProps {\n  showXAxis?: boolean;\n  showYAxis?: boolean;\n  showGrid?: boolean;\n}\n\nfunction WaterfallLabelChart({\n  data,\n  className,\n  showTooltip = true,\n  tooltipIndicator = \"dot\",\n  valueFormatter = defaultValueFormatter,\n  showXAxis = true,\n  showYAxis = false,\n  showGrid = false,\n  barSize,\n}: WaterfallLabelChartProps) {\n  const chartData = transformWaterfallData(data);\n\n  return (\n    <div className={cn(\"w-full\", className)}>\n      <ResponsiveContainer width=\"100%\" height=\"100%\">\n        <BarChart\n          data={chartData}\n          barGap={0}\n          barCategoryGap=\"20%\"\n          barSize={barSize}\n        >\n          {showGrid && (\n            <CartesianGrid\n              strokeDasharray=\"3 3\"\n              vertical={false}\n              stroke=\"var(--color-border)\"\n            />\n          )}\n          {showXAxis && (\n            <XAxis\n              dataKey=\"name\"\n              tickLine={false}\n              axisLine={false}\n              tick={{ fill: \"var(--color-muted-foreground)\", fontSize: 12 }}\n              tickMargin={8}\n              interval={0}\n            />\n          )}\n          {showYAxis && (\n            <YAxis\n              tickLine={false}\n              axisLine={false}\n              tick={{ fill: \"var(--color-muted-foreground)\", fontSize: 12 }}\n              tickFormatter={valueFormatter}\n              width={60}\n            />\n          )}\n          <ReferenceLine y={0} stroke=\"var(--color-border)\" />\n          {showTooltip && (\n            <Tooltip\n              content={\n                <ChartTooltip\n                  indicator={tooltipIndicator}\n                  valueFormatter={valueFormatter}\n                />\n              }\n              cursor={false}\n            />\n          )}\n          <Bar\n            dataKey=\"start\"\n            stackId=\"waterfall\"\n            fill=\"transparent\"\n            radius={0}\n          />\n          <Bar dataKey=\"value\" stackId=\"waterfall\" radius={[4, 4, 0, 0]}>\n            {chartData.map((entry, index) => (\n              <Cell\n                key={`cell-${index}`}\n                fill={\n                  entry.isTotal\n                    ? COLORS.total\n                    : entry.isPositive\n                      ? COLORS.positive\n                      : COLORS.negative\n                }\n              />\n            ))}\n            <LabelList\n              dataKey=\"displayValue\"\n              position=\"top\"\n              fill=\"var(--color-foreground)\"\n              fontSize={11}\n              fontWeight={500}\n              offset={8}\n              content={(props: any) => {\n                const { x, y, width, value } = props;\n                if (value === undefined || value === null) return null;\n                return (\n                  <text\n                    x={x + width / 2}\n                    y={y - 8}\n                    fill=\"var(--color-foreground)\"\n                    fontSize={11}\n                    fontWeight={500}\n                    textAnchor=\"middle\"\n                  >\n                    {`${value >= 0 ? \"+\" : \"\"}${valueFormatter(value)}`}\n                  </text>\n                );\n              }}\n            />\n          </Bar>\n        </BarChart>\n      </ResponsiveContainer>\n    </div>\n  );\n}\n\n// ============================================================================\n// 3. Waterfall Chart - Custom Label (inside bars)\n// ============================================================================\n\nfunction WaterfallCustomLabelChart({\n  data,\n  className,\n  showTooltip = true,\n  tooltipIndicator = \"dashed\",\n  valueFormatter = defaultValueFormatter,\n  barSize,\n}: WaterfallChartBaseProps) {\n  const chartData = transformWaterfallData(data);\n\n  return (\n    <div className={cn(\"w-full\", className)}>\n      <ResponsiveContainer width=\"100%\" height=\"100%\">\n        <BarChart\n          data={chartData}\n          barGap={0}\n          barCategoryGap=\"20%\"\n          barSize={barSize}\n        >\n          <XAxis\n            dataKey=\"name\"\n            tickLine={false}\n            axisLine={false}\n            tick={{ fill: \"var(--color-muted-foreground)\", fontSize: 12 }}\n            tickMargin={8}\n            interval={0}\n          />\n          <YAxis hide domain={[0, \"auto\"]} />\n          <ReferenceLine y={0} stroke=\"var(--color-border)\" />\n          {showTooltip && (\n            <Tooltip\n              content={\n                <ChartTooltip\n                  indicator={tooltipIndicator}\n                  valueFormatter={valueFormatter}\n                />\n              }\n              cursor={false}\n            />\n          )}\n          <Bar\n            dataKey=\"start\"\n            stackId=\"waterfall\"\n            fill=\"transparent\"\n            radius={0}\n          />\n          <Bar dataKey=\"value\" stackId=\"waterfall\" radius={[4, 4, 0, 0]}>\n            {chartData.map((entry, index) => (\n              <Cell\n                key={`cell-${index}`}\n                fill={\n                  entry.isTotal\n                    ? COLORS.total\n                    : entry.isPositive\n                      ? COLORS.positive\n                      : COLORS.negative\n                }\n              />\n            ))}\n            <LabelList\n              dataKey=\"displayValue\"\n              position=\"center\"\n              fill=\"#ffffff\"\n              fontSize={10}\n              fontWeight={600}\n              content={(props: any) => {\n                const { x, y, width, height, value } = props;\n                if (value === undefined || value === null) return null;\n                return (\n                  <text\n                    x={x + width / 2}\n                    y={y + height / 2}\n                    fill=\"#ffffff\"\n                    fontSize={10}\n                    fontWeight={600}\n                    textAnchor=\"middle\"\n                    dominantBaseline=\"middle\"\n                  >\n                    {valueFormatter(value)}\n                  </text>\n                );\n              }}\n            />\n          </Bar>\n        </BarChart>\n      </ResponsiveContainer>\n    </div>\n  );\n}\n\n// ============================================================================\n// 4. Waterfall Chart - Legend\n// ============================================================================\n\ninterface WaterfallLegendChartProps extends WaterfallChartBaseProps {\n  legendPosition?: \"top\" | \"bottom\";\n  showXAxis?: boolean;\n  showYAxis?: boolean;\n  showGrid?: boolean;\n}\n\nfunction WaterfallLegendChart({\n  data,\n  className,\n  showTooltip = true,\n  tooltipIndicator = \"line\",\n  valueFormatter = defaultValueFormatter,\n  legendPosition = \"bottom\",\n  showXAxis = true,\n  showYAxis = true,\n  showGrid = true,\n  barSize,\n}: WaterfallLegendChartProps) {\n  const chartData = transformWaterfallData(data);\n  const hasTotal = data.some((d) => d.isTotal);\n\n  return (\n    <div className={cn(\"flex flex-col\", className)}>\n      {legendPosition === \"top\" && (\n        <ChartLegend showTotal={hasTotal} className=\"pb-4\" />\n      )}\n      <div className=\"flex-1 min-h-0\">\n        <ResponsiveContainer width=\"100%\" height=\"100%\">\n          <BarChart\n            data={chartData}\n            barGap={0}\n            barCategoryGap=\"20%\"\n            barSize={barSize}\n          >\n            {showGrid && (\n              <CartesianGrid\n                strokeDasharray=\"3 3\"\n                vertical={false}\n                stroke=\"var(--color-border)\"\n              />\n            )}\n            {showXAxis && (\n              <XAxis\n                dataKey=\"name\"\n                tickLine={false}\n                axisLine={false}\n                tick={{ fill: \"var(--color-muted-foreground)\", fontSize: 12 }}\n                tickMargin={8}\n                interval={0}\n              />\n            )}\n            {showYAxis && (\n              <YAxis\n                tickLine={false}\n                axisLine={false}\n                tick={{ fill: \"var(--color-muted-foreground)\", fontSize: 12 }}\n                tickFormatter={valueFormatter}\n                width={60}\n              />\n            )}\n            <ReferenceLine y={0} stroke=\"var(--color-border)\" />\n            {showTooltip && (\n              <Tooltip\n                content={\n                  <ChartTooltip\n                    indicator={tooltipIndicator}\n                    valueFormatter={valueFormatter}\n                  />\n                }\n                cursor={false}\n              />\n            )}\n            <Bar\n              dataKey=\"start\"\n              stackId=\"waterfall\"\n              fill=\"transparent\"\n              radius={0}\n            />\n            <Bar dataKey=\"value\" stackId=\"waterfall\" radius={[4, 4, 0, 0]}>\n              {chartData.map((entry, index) => (\n                <Cell\n                  key={`cell-${index}`}\n                  fill={\n                    entry.isTotal\n                      ? COLORS.total\n                      : entry.isPositive\n                        ? COLORS.positive\n                        : COLORS.negative\n                  }\n                />\n              ))}\n            </Bar>\n          </BarChart>\n        </ResponsiveContainer>\n      </div>\n      {legendPosition === \"bottom\" && (\n        <ChartLegend showTotal={hasTotal} className=\"pt-4\" />\n      )}\n    </div>\n  );\n}\n\n// ============================================================================\n// 5. Waterfall Chart - Horizontal\n// ============================================================================\n\nfunction WaterfallHorizontalChart({\n  data,\n  className,\n  showTooltip = true,\n  tooltipIndicator = \"dot\",\n  valueFormatter = defaultValueFormatter,\n  barSize,\n}: WaterfallChartBaseProps) {\n  const chartData = transformWaterfallData(data);\n\n  return (\n    <div className={cn(\"w-full\", className)}>\n      <ResponsiveContainer width=\"100%\" height=\"100%\">\n        <BarChart\n          data={chartData}\n          layout=\"vertical\"\n          barGap={0}\n          barCategoryGap=\"20%\"\n          barSize={barSize}\n        >\n          <CartesianGrid\n            strokeDasharray=\"3 3\"\n            horizontal={false}\n            stroke=\"var(--color-border)\"\n          />\n          <XAxis\n            type=\"number\"\n            tickLine={false}\n            axisLine={false}\n            tick={{ fill: \"var(--color-muted-foreground)\", fontSize: 12 }}\n            tickFormatter={valueFormatter}\n          />\n          <YAxis\n            type=\"category\"\n            dataKey=\"name\"\n            tickLine={false}\n            axisLine={false}\n            tick={{ fill: \"var(--color-muted-foreground)\", fontSize: 12 }}\n            width={80}\n            interval={0}\n          />\n          <ReferenceLine x={0} stroke=\"var(--color-border)\" />\n          {showTooltip && (\n            <Tooltip\n              content={\n                <ChartTooltip\n                  indicator={tooltipIndicator}\n                  valueFormatter={valueFormatter}\n                />\n              }\n              cursor={false}\n            />\n          )}\n          <Bar\n            dataKey=\"start\"\n            stackId=\"waterfall\"\n            fill=\"transparent\"\n            radius={0}\n          />\n          <Bar dataKey=\"value\" stackId=\"waterfall\" radius={[0, 4, 4, 0]}>\n            {chartData.map((entry, index) => (\n              <Cell\n                key={`cell-${index}`}\n                fill={\n                  entry.isTotal\n                    ? COLORS.total\n                    : entry.isPositive\n                      ? COLORS.positive\n                      : COLORS.negative\n                }\n              />\n            ))}\n          </Bar>\n        </BarChart>\n      </ResponsiveContainer>\n    </div>\n  );\n}\n\n// ============================================================================\n// 6. Waterfall Chart - Interactive (Negative highlighting)\n// ============================================================================\n\nfunction WaterfallInteractiveChart({\n  data,\n  className,\n  showTooltip = true,\n  tooltipIndicator = \"dot\",\n  valueFormatter = defaultValueFormatter,\n  barSize,\n}: WaterfallChartBaseProps) {\n  const [activeIndex, setActiveIndex] = React.useState<number | null>(null);\n  const chartData = transformWaterfallData(data);\n\n  return (\n    <div className={cn(\"w-full\", className)}>\n      <ResponsiveContainer width=\"100%\" height=\"100%\">\n        <BarChart\n          data={chartData}\n          barGap={0}\n          barCategoryGap=\"20%\"\n          barSize={barSize}\n        >\n          <CartesianGrid\n            strokeDasharray=\"3 3\"\n            vertical={false}\n            stroke=\"var(--color-border)\"\n          />\n          <XAxis\n            dataKey=\"name\"\n            tickLine={false}\n            axisLine={false}\n            tick={{ fill: \"var(--color-muted-foreground)\", fontSize: 12 }}\n            tickMargin={8}\n            interval={0}\n          />\n          <YAxis\n            tickLine={false}\n            axisLine={false}\n            tick={{ fill: \"var(--color-muted-foreground)\", fontSize: 12 }}\n            tickFormatter={valueFormatter}\n            width={60}\n          />\n          <ReferenceLine y={0} stroke=\"var(--color-border)\" />\n          {showTooltip && (\n            <Tooltip\n              content={\n                <ChartTooltip\n                  indicator={tooltipIndicator}\n                  valueFormatter={valueFormatter}\n                />\n              }\n              cursor={false}\n            />\n          )}\n          <Bar\n            dataKey=\"start\"\n            stackId=\"waterfall\"\n            fill=\"transparent\"\n            radius={0}\n          />\n          <Bar\n            dataKey=\"value\"\n            stackId=\"waterfall\"\n            radius={[4, 4, 0, 0]}\n            onMouseEnter={(_, index) => setActiveIndex(index)}\n            onMouseLeave={() => setActiveIndex(null)}\n          >\n            {chartData.map((entry, index) => (\n              <Cell\n                key={`cell-${index}`}\n                fill={\n                  entry.isTotal\n                    ? COLORS.total\n                    : entry.isPositive\n                      ? COLORS.positive\n                      : COLORS.negative\n                }\n                opacity={\n                  activeIndex === null || activeIndex === index ? 1 : 0.3\n                }\n                style={{ cursor: \"pointer\", transition: \"opacity 150ms\" }}\n              />\n            ))}\n          </Bar>\n        </BarChart>\n      </ResponsiveContainer>\n    </div>\n  );\n}\n\n// ============================================================================\n// Exports\n// ============================================================================\n\nexport {\n  WaterfallChart,\n  WaterfallLabelChart,\n  WaterfallCustomLabelChart,\n  WaterfallLegendChart,\n  WaterfallHorizontalChart,\n  WaterfallInteractiveChart,\n  ChartTooltip,\n  ChartLegend,\n  defaultValueFormatter,\n  COLORS,\n};\n",
      "type": "registry:ui",
      "target": "components/ruixen/waterfall-chart.tsx"
    }
  ]
}